<!DOCTYPE html>
<html lang="pt-BR">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üéÆ Retro Games Collection</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Courier New', monospace;
            background: #1a1a2e;
            color: #eee;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            text-align: center;
            margin-bottom: 30px;
            background: linear-gradient(45deg, #16213e, #0f3460);
            padding: 20px;
            border-radius: 10px;
        }

        .header h1 {
            color: #00ff41;
            text-shadow: 0 0 10px #00ff41;
            font-size: 2.5em;
        }

        .filters {
            display: flex;
            gap: 15px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }

        .filters select,
        .filters button {
            padding: 10px;
            background: #16213e;
            color: #eee;
            border: 1px solid #00ff41;
            border-radius: 5px;
        }

        .game-form {
            background: #16213e;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
            border: 1px solid #00ff41;
        }

        .form-row {
            display: flex;
            gap: 15px;
            margin-bottom: 15px;
            flex-wrap: wrap;
        }

        .form-group {
            flex: 1;
            min-width: 200px;
        }

        .form-group label {
            display: block;
            margin-bottom: 5px;
            color: #00ff41;
        }

        .form-group input,
        .form-group select,
        .form-group textarea {
            width: 100%;
            padding: 8px;
            background: #0f3460;
            color: #eee;
            border: 1px solid #00ff41;
            border-radius: 5px;
        }

        .btn {
            background: #00ff41;
            color: #000;
            padding: 10px 20px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-weight: bold;
        }

        .btn:hover {
            background: #00cc33;
        }

        .btn-danger {
            background: #ff4757;
            color: white;
        }

        .btn-danger:hover {
            background: #ff3742;
        }

        .games-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 20px;
        }

        .game-card {
            background: #16213e;
            border: 1px solid #00ff41;
            border-radius: 10px;
            padding: 20px;
            transition: transform 0.3s;
        }

        .game-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 5px 15px rgba(0, 255, 65, 0.3);
        }

        .game-title {
            color: #00ff41;
            font-size: 1.3em;
            margin-bottom: 10px;
        }

        .game-info {
            margin-bottom: 8px;
        }

        .game-console {
            background: #0f3460;
            padding: 5px 10px;
            border-radius: 15px;
            display: inline-block;
            margin-right: 10px;
        }

        .game-genre {
            background: #ff6b6b;
            padding: 5px 10px;
            border-radius: 15px;
            display: inline-block;
        }

        .favorite {
            color: #ffd700;
        }

        .rating {
            color: #00ff41;
        }

        .game-actions {
            margin-top: 15px;
            display: flex;
            gap: 10px;
        }
    </style>
</head>

<body>
    <div class="container">
        <div class="header">
            <h1>üéÆ RETRO GAMES COLLECTION</h1>
            <p>Seu cat√°logo de jogos cl√°ssicos</p>
        </div>

        <div class="filters">
            <select id="consoleFilter">
                <option value="">Todos os Consoles</option>
            </select>
            <select id="genreFilter">
                <option value="">Todos os G√™neros</option>
            </select>
            <button onclick="toggleFavorites()">‚≠ê Favoritos</button>
            <button onclick="clearFilters()">üîÑ Limpar Filtros</button>
        </div>

        <div class="game-form" id="gameForm">
            <h2>‚ûï Adicionar Jogo</h2>
            <div class="form-row">
                <div class="form-group">
                    <label>T√≠tulo:</label>
                    <input type="text" id="titulo" required>
                </div>
                <div class="form-group">
                    <label>Console:</label>
                    <select id="console" required></select>
                </div>
            </div>
            <div class="form-row">
                <div class="form-group">
                    <label>Ano:</label>
                    <input type="number" id="ano" min="1970" max="2000" required>
                </div>
                <div class="form-group">
                    <label>G√™nero:</label>
                    <select id="genero" required></select>
                </div>
            </div>
            <div class="form-row">
                <div class="form-group">
                    <label>Desenvolvedor:</label>
                    <input type="text" id="desenvolvedor" required>
                </div>
                <div class="form-group">
                    <label>Nota (0-10):</label>
                    <input type="number" id="nota" min="0" max="10" step="0.1">
                </div>
            </div>
            <div class="form-group">
                <label>Descri√ß√£o:</label>
                <textarea id="descricao" rows="3"></textarea>
            </div>
            <button class="btn" onclick="addGame()">Adicionar Jogo</button>
            <button class="btn" id="updateBtn" onclick="updateGame()" style="display:none;">Atualizar</button>
            <button class="btn-danger" id="cancelBtn" onclick="cancelEdit()" style="display:none;">Cancelar</button>
        </div>

        <div class="games-grid" id="gamesGrid"></div>
    </div>

    <script>
        let editingGameId = null;
        let showingFavorites = false;

        async function loadConsoles() {
            const response = await fetch('/consoles');
            const consoles = await response.json();

            const consoleSelect = document.getElementById('console');
            const consoleFilter = document.getElementById('consoleFilter');

            consoles.forEach(console => {
                consoleSelect.innerHTML += `<option value="${console.value}">${console.name}</option>`;
                consoleFilter.innerHTML += `<option value="${console.value}">${console.name}</option>`;
            });
        }

        async function loadGenres() {
            const response = await fetch('/genres');
            const genres = await response.json();

            const genreSelect = document.getElementById('genero');
            const genreFilter = document.getElementById('genreFilter');

            genres.forEach(genre => {
                genreSelect.innerHTML += `<option value="${genre.value}">${genre.name}</option>`;
                genreFilter.innerHTML += `<option value="${genre.value}">${genre.name}</option>`;
            });
        }

        async function loadGames() {
            const consoleFilter = document.getElementById('consoleFilter').value;
            const genreFilter = document.getElementById('genreFilter').value;

            let url = '/games?';
            if (consoleFilter) url += `console=${consoleFilter}&`;
            if (genreFilter) url += `genero=${genreFilter}&`;
            if (showingFavorites) url += 'favoritos=true&';

            const response = await fetch(url);
            const games = await response.json();

            const gamesGrid = document.getElementById('gamesGrid');
            gamesGrid.innerHTML = games.map(game => `
                <div class="game-card">
                    <div class="game-title">${game.titulo} ${game.favorito ? '‚≠ê' : ''}</div>
                    <div class="game-info">
                        <span class="game-console">${game.console}</span>
                        <span class="game-genre">${game.genero}</span>
                    </div>
                    <div class="game-info"><strong>Ano:</strong> ${game.ano}</div>
                    <div class="game-info"><strong>Desenvolvedor:</strong> ${game.desenvolvedor}</div>
                    ${game.nota ? `<div class="game-info rating"><strong>Nota:</strong> ${game.nota}/10</div>` : ''}
                    ${game.descricao ? `<div class="game-info">${game.descricao}</div>` : ''}
                    <div class="game-actions">
                        <button class="btn" onclick="editGame(${game.id})">‚úèÔ∏è Editar</button>
                        <button class="btn" onclick="toggleFavorite(${game.id})">${game.favorito ? 'üíî' : '‚ù§Ô∏è'}</button>
                        <button class="btn-danger" onclick="deleteGame(${game.id})">üóëÔ∏è Deletar</button>
                    </div>
                </div>
            `).join('');
        }

        async function addGame() {
            const gameData = {
                titulo: document.getElementById('titulo').value,
                console: document.getElementById('console').value,
                ano: parseInt(document.getElementById('ano').value),
                genero: document.getElementById('genero').value,
                desenvolvedor: document.getElementById('desenvolvedor').value,
                descricao: document.getElementById('descricao').value,
                nota: document.getElementById('nota').value ? parseFloat(document.getElementById('nota').value) : null
            };

            await fetch('/games', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(gameData)
            });

            clearForm();
            loadGames();
        }

        async function editGame(id) {
            const response = await fetch(`/games/${id}`);
            const game = await response.json();

            document.getElementById('titulo').value = game.titulo;
            document.getElementById('console').value = game.console;
            document.getElementById('ano').value = game.ano;
            document.getElementById('genero').value = game.genero;
            document.getElementById('desenvolvedor').value = game.desenvolvedor;
            document.getElementById('descricao').value = game.descricao || '';
            document.getElementById('nota').value = game.nota || '';

            editingGameId = id;
            document.getElementById('updateBtn').style.display = 'inline';
            document.getElementById('cancelBtn').style.display = 'inline';
            document.querySelector('button[onclick="addGame()"]').style.display = 'none';
        }

        async function updateGame() {
            const gameData = {
                titulo: document.getElementById('titulo').value,
                console: document.getElementById('console').value,
                ano: parseInt(document.getElementById('ano').value),
                genero: document.getElementById('genero').value,
                desenvolvedor: document.getElementById('desenvolvedor').value,
                descricao: document.getElementById('descricao').value,
                nota: document.getElementById('nota').value ? parseFloat(document.getElementById('nota').value) : null
            };

            await fetch(`/games/${editingGameId}`, {
                method: 'PUT',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(gameData)
            });

            cancelEdit();
            loadGames();
        }

        async function deleteGame(id) {
            if (confirm('Tem certeza que deseja deletar este jogo?')) {
                await fetch(`/games/${id}`, { method: 'DELETE' });
                loadGames();
            }
        }

        async function toggleFavorite(id) {
            const response = await fetch(`/games/${id}`);
            const game = await response.json();

            await fetch(`/games/${id}`, {
                method: 'PUT',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ favorito: !game.favorito })
            });

            loadGames();
        }

        function toggleFavorites() {
            showingFavorites = !showingFavorites;
            loadGames();
        }

        function clearFilters() {
            document.getElementById('consoleFilter').value = '';
            document.getElementById('genreFilter').value = '';
            showingFavorites = false;
            loadGames();
        }

        function cancelEdit() {
            editingGameId = null;
            clearForm();
            document.getElementById('updateBtn').style.display = 'none';
            document.getElementById('cancelBtn').style.display = 'none';
            document.querySelector('button[onclick="addGame()"]').style.display = 'inline';
        }

        function clearForm() {
            document.getElementById('titulo').value = '';
            document.getElementById('console').value = '';
            document.getElementById('ano').value = '';
            document.getElementById('genero').value = '';
            document.getElementById('desenvolvedor').value = '';
            document.getElementById('descricao').value = '';
            document.getElementById('nota').value = '';
        }

        // Event listeners para filtros
        document.getElementById('consoleFilter').addEventListener('change', loadGames);
        document.getElementById('genreFilter').addEventListener('change', loadGames);

        // Inicializar
        loadConsoles();
        loadGenres();
        loadGames();
    </script>
</body>

</html>